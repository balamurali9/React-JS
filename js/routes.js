var SettingsRouteController=Backbone.Router.extend({routes:{settings:"loadSettings",changePassword:"changePassword",editProfile:"editProfile","*path":"loadSettings"},editProfile:function(){checkAndRender("EditProfile",paramObj,"settingsContainer")},loadDevices:function(){checkAndRender("DeviceManager",paramObj,"settingsContainer")},changePassword:function(){checkAndRender("ChangePassword",paramObj,"settingsContainer")},loadSettings:function(){checkAndRender("SettingsForm",paramObj,"settingsContainer")}});
var ProfileRouteController=Backbone.Router.extend({routes:{connections:"loadConnections",friendRequest:"friendRequest",wellBeingStory:"loadWellBeingStory",insights:"loadInsights",activity:"loadActivity","*path":"loadActivity"},loadActivity:function(){checkAndRender("ActivitiesPanelAll",paramObj,"profileContainer"),$("#profile_tab_buttons a").removeClass("active"),$("#btnActivity").addClass("active"),$("#btnActivity").focus()},loadConnections:function(){paramObj.activeTab="connections",checkAndRender("UserConnectionsPanel",paramObj,"profileContainer"),$("#profile_tab_buttons a").removeClass("active"),$("#btnFriends").addClass("active"),$("#btnConnections").focus()},loadInsights:function(){checkAndRender("InsightsPanelAll",paramObj,"profileContainer"),$("#profile_tab_buttons a").removeClass("active"),$("#btnInsights").addClass("active"),$("#btnInsights").focus()},friendRequest:function(){checkAndRender("UserConnectionsPanel",paramObj,"profileContainer"),$("#btnFriends").addClass("active"),$("#btnFriends").focus()},loadWellBeingStory:function(){paramObj.activeTab="wellBeingStory",checkAndRender("WellBeingCreateStory",paramObj,"profileContainer"),$("#btnFriends").removeClass("active"),$("#btnwellBeingStory").addClass("active")}});
function handleStageImageLoad(e){var t=(e.width+"_"+e.height,{h:$(e).parent().height(),w:$(e).parent().width()}),o=t.w/t.h,n=e.width/e.height;o>n?$(e).css("width","100%"):$(e).css("height","100%"),$(e).removeClass("hidden")}function getQueryStringValue(e){return unescape(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+escape(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}function checkAndRenderComponent(e,t,o,n){if(gJsxRenderedParents[o]=e,AppLogger.log("Retrying to render "+e+" .."),"undefined"==typeof window[e])return void setTimeout(function(){gJsxRenderedParents[o]==e&&checkAndRender(e,t,o,n)},500);var i=React.render(React.createElement(window[e],t),document.getElementById(o));n&&n(i)}function jiyoFromNow(e){var t=new Date(1e3*e),o=new Date(1e3*moment().format("X")),n=Math.floor((o-t)/1e3),i=Math.floor(n/60),r=Math.floor(i/60),a=Math.floor(r/24);return dateStr=moment(1e3*e).format("MMM DD, YYYY"),1>=n?"1 second ago":60>n?n+" seconds ago":1==i?i+" minute ago":60>i?i+" minutes ago":1==r?r+" hour ago":24>r?r+" hours ago":1==a?a+" day ago":7>a?a+" days ago":a>=7?moment(1e3*e).format("MMM DD, YYYY"):dateStr}$.fn.serializeToObject=function(){var e=$(this).serializeArray(),t={};return _.reduce(e,function(e,t){return e[t.name]=t.value,e},t),t},"undefined"==typeof window.console&&(window.console={log:function(){}}),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},$.ajaxPrefilter(function(e){e.beforeSend||(e.beforeSend=function(e){e.setRequestHeader("JIYO-DEVICE-WIDTH",window.screen.width),"undefined"!=typeof gAuth&&e.setRequestHeader("JIYO-ACCESS-TOKEN",gAuth.token)})});var Api={makeRequest:function(e,t){$("#top_error_panel").addClass("hidden"),$.ajax(e).done(function(e){t&&t(e),$("#topErrorMessageArea").addClass("hidden")}).fail(function(e){$("#top_error_panel").html("An Unexpected error occured").removeClass("hidden")}).error(function(e){401==e.status&&(document.location.href="/home"),0==e.status&&0==e.readyState&&$("#topErrorMessageArea").text("Unable to reach server, Please check your network connection ..").removeClass("hidden")})},postData:function(e,t,o){"function"==typeof t&&(o=t,t={}),t._token=gAppConfig.CSRFToken,this.makeRequest({url:e,type:"POST",data:t},o)},deleteData:function(e,t,o){t._token=gCSRFToken,this.makeRequest({url:e,type:"DELETE",data:t},o)},getData:function(e,t,o){"function"==typeof t&&(o=t,t={}),this.makeRequest({url:e,type:"GET",data:t},o)}},JiyoEvent={subscribers:{},subscribe:function(e,t){"undefined"==typeof this.subscribers[e]&&(this.subscribers[e]=[]),this.subscribers[e].push(t)},fire:function(e,t){var o=this.subscribers[e];if(o)for(var n=0;n<o.length;n++)o[n](t)}},Strings={programSelect:{},facetProgress:{title:"Facet Information"}},ServerPostMixin={stopEvent:function(e){return e.preventDefault(),e.stopPropagation(),!1},postData:function(e,t,o){var n=this,i=n.state;for(var r in i.errorMessages)i.errorMessages[r]=null;Api.postData(e,t,function(e){if(i.response=e,e.success)return void(o&&o(i));var t=e.data;for(var n in t){var r=t[n];i.errorMessages[n]=r}o&&(i.response=e,o(i))})}},gJsxRenderedParents={},AppLogger={log:function(){gAppConfig.debugEnabled&&console.log.apply(console,arguments)}},UserViewsManager={viewedObjects:{},hasViewed:function(e){return 1==this.viewedObjects[e]},init:function(){var e=this;JiyoEvent.subscribe("app_init",function(t){Api.getData("/content/user-article-views",{},function(t){e.viewedObjects=t.data})})}};UserViewsManager.init();var UserLikesManager={likedObjects:[],like:function(e,t){var o=this;Api.getData("/content/like/"+e,{},function(t){1==t.data.meLiked&&(o.likedObjects.push(e),t.data.uuid=e,JiyoEvent.fire("object_like",t.data))})},unlike:function(e){var t=this;Api.getData("/content/unlike/"+e,{},function(o){0==o.data.meLiked&&(t.likedObjects=_.without(t.likedObjects,e),o.data.uuid=e,JiyoEvent.fire("object_unlike",o.data))})},init:function(){var e=this;JiyoEvent.subscribe("app_init",function(t){Api.getData("/content/user-likes",{},function(t){e.likedObjects=t.data,e.likedObjects.forEach(function(e){JiyoEvent.fire("object_like",{uuid:e})})})})},hasLiked:function(e){for(var t=0;t<this.likedObjects.length;t++)if(this.likedObjects[t]==e)return!0;return!1}};UserLikesManager.init(),$(document).ready(function(){for($(".facebookBtn").click(function(){ga("send","event","button","facebook_connect","click")}),$(".googleplusBtn").click(function(){ga("send","event","button","google_connect","click")}),$(".ga_logout").click(function(){ga("send","event","button","logout","click")});gInitializerList.length;){var e=gInitializerList.pop();e()}for(;gComponentsToRender.length;){var t=gComponentsToRender.pop();checkAndRenderComponent(t.viewController,t.params,t.container,t.cb)}0!=$("#imageCropForm").length&&($("#imageCropForm").submit(function(e){var t=$("#imageCropForm").serializeToObject();return console.log(t),Api.postData("/user/profile-image",t,function(e){$("#user_profile_image").attr("src",e.data.cdn_url),$("#profileImageCropModal").modal("hide"),JiyoEvent.fire("update_activity"),$("#profileImagePreview").cropper("destroy")}),e.preventDefault(),e.stopPropagation(),!1}),$("form#imageCropForm .modal-header .close").on("click",function(){return $("#profileImageCropModal").modal("hide"),$("#profileImagePreview").cropper("destroy"),!1}),$("#profileImagePreview").on("load",function(){-1==$(this).attr("src").indexOf("loading.gif")&&($("#profileImageBusyState").addClass("hidden"),$("#profileImageCropModal").modal("show"),$("#profileImagePreview").cropper({aspectRatio:1,height:200,done:function(e){$("#crop_media_x").val(e.x),$("#crop_media_y").val(e.y),$("#crop_media_width").val(e.width),$("#crop_media_height").val(e.height)}}))}),$("#profileimage_upload").fileupload({url:"/user/upload?_token={{ csrf_token() }}",dataType:"json",done:function(e,t){var o=t.response();return 0==o.result.success?($("#profileImageBusyState").addClass("hidden"),alert(o.result.message),!1):($("#crop_media_id").val(o.result.data.id),void $("#profileImagePreview").attr("src",o.result.data.cdn_url))},start:function(){$("#profileImageBusyState").removeClass("hidden")},add:function(e,t){var o=t.files[0].name.split(".").pop(),n="jpeg,jpg,png,gif";return o=o.toLowerCase(),n.indexOf(o)<0?(alert("Are you sure this is an image file?"),!1):void t.submit()}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"),$("#coverimage_upload").fileupload({url:"/user/upload?_token={{ csrf_token() }}",dataType:"json",done:function(e,t){var o=t.response();return 0==o.result.success?($("#coverImageBusyState").addClass("hidden"),alert(o.result.message),!1):($("#coverImageBusyState").addClass("hidden"),$(".profile-picture").css("background-image","url('"+o.result.data.cdn_url+"')"),void JiyoEvent.fire("update_activity"))},start:function(){$("#coverImageBusyState").removeClass("hidden")},add:function(e,t){var o=t.files[0].name.split(".").pop(),n="jpeg,jpg,png,gif";return o=o.toLowerCase(),n.indexOf(o)<0?(alert("Are you sure this is an image file?"),!1):void t.submit()}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?void 0:"disabled"))});